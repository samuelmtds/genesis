<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Arquitetura do binding - genesis</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Michael Nascimento Santos"></meta><meta name="email" content="mister__m@dev.java.net"></meta></head><body class="composite"><div id="banner"><a href="https://genesis.dev.java.net/" id="projectLogo"><img alt="SOL Genesis" src="../genesis.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 26 December 2005
                <span class="separator">|</span> Doc for  3.0-EA2
                </div><div class="xright">
        
        <a href="../index.html">genesis</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-server/index.html">genesis-server</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-client/index.html">genesis-client</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-shared/index.html">genesis-shared</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-aspect/index.html">genesis-aspect</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../tags/genesis-tags.html">genesis-xdoclet</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menugenesis"><h5>genesis</h5><ul><li class="none"><a href="../pt-BR/index.html">Visão geral</a></li><li class="none"><a href="../pt-BR/screenshots.html">Screenshots</a></li><li class="none"><a href="../pt-BR/download.html">Downloads</a></li><li class="none"><a href="../pt-BR/release_notes.html">Notas de versão</a></li></ul></div><div id="menuDocumentação"><h5>Documentação</h5><ul><li class="collapsed"><a href="../pt-BR/documentation_intro.html">Manual do usuário</a></li><li class="none"><a href="../pt-BR/jars_explained.html">Entendendo os jars do genesis</a></li><li class="none"><a href="../pt-BR/empty_project.html">Desenvolvendo com o genesis</a></li><li class="none"><a href="../pt-BR/empty_web_project.html">Desenvolvendo com o genesis (WEB)</a></li><li class="none"><a href="../pt-BR/useradmin_sample.html">Usando o exemplo UserAdmin</a></li><li class="collapsed"><a href="../pt-BR/advanced_introduction.html">Guia avançado</a></li><li class="none"><a href="../pt-BR/faq.html">FAQ</a></li><li class="none"><a href="http://wiki.java.net/bin/view/Projects/GenesisRoadmap" class="externalLink" title="External Link">Roadmap</a></li><li class="none"><a href="http://wiki.java.net/bin/view/Projects/Genesis" class="externalLink" title="External Link">Wiki</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="http://maven.apache.org/development-process.html" class="externalLink" title="External Link">Development Process</a></li></ul></div><div id="menujava_net"><h5>java.net</h5><ul><li class="none"><a href="https://genesis.dev.java.net" class="externalLink" title="External Link">genesis.dev.java.net</a></li><li class="none"><a href="http://java.net" class="externalLink" title="External Link"><img title="java.net member" style="border: 1px" src="../java_dot_net_member.bmp" alt="java.net member"></img></a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/maven-button-1.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Arquitetura_do_binding"></a><h2>Arquitetura do binding</h2>
      <p align="justify">Esta seção descreve como a arquitetura do binding, uma
      das partes mais inovadoras e interessantes do genesis, funciona
      internamente. Os detalhes explicados aqui podem ser usados para se
      escrever testes unitários dos forms, obter notificação de eventos ou para
      customizar a forma com que certo componente é ligado a view, por exemplo.
      </p>
      <p align="justify">Conforme salientado na <a href="advanced_introduction.html">introdução do guia avançado</a>, toda a
      API e semântica aqui documentados podem ser alterados de forma
      incompatível em futuras versões do genesis e é aconselhável notificar os
      desenvolvedores caso algum recurso seja usado.</p>
      <ul>
         <li><a href="#Principais_elementos_do_binding">Principais elementos do
         binding</a></li>
         <li><a href="#Modelo_de_metadados_do_form">Modelo de metadados do form
         </a></li>
         <li><a href="#Manipulando_o_estado_do_form">Manipulando o estado do
         form</a></li>
      </ul>
    </div><div class="section"><a name="Principais_elementos_do_binding"></a><h2>Principais elementos do binding</h2>
      <p>Classes em quatro pacotes do genesis estão envolvidas no processo de
      binding. Os pacotes são:</p>
      <ul>
        <li><b><code>net.java.dev.genesis.ui.metadata</code></b>: contém um
        modelo que representa os metadados do form do genesis</li>
        <li><b><code>net.java.dev.genesis.ui.controller</code></b>: contém as
        interfaces responsáveis pelo controle e notificação de mudanças do
        estado do form</li>
        <li><b><code>net.java.dev.genesis.ui.thinlet.metadata</code></b>:
        contém um modelo que representa os metadados da view em
        <code>Thinlet</code></li>
        <li><b><code>net.java.dev.genesis.ui.thinlet</code></b>: contém as
        classes responsáveis pelo binding <code>Thinlet</code></li>
      </ul>
      <p>Cada um dos pacotes acima será detalhado nas seções subseqüentes.</p>
    </div><div class="section"><a name="Modelo_de_metadados_do_form"></a><h2>Modelo de metadados do form</h2>
      <p>Conforme explicado na documentação dos aspectos, todo o modelo de
      metadados de um form é  construído através de uma instância de
      <code>net.java.dev.genesis.ui.metadata.FormMetadataFactory</code>, cuja
      interface é:</p>

    <div class="source"><pre>
public interface FormMetadataFactory {
    public FormMetadata getFormMetadata(Class formClass);
}
</pre></div>
  
      <p>Para mais detalhes de como utilizar uma implementação customizada desta
      interface, basta consultar a subseção da <a href="aspects.html#Instanciando_os_metadados">documentação dos
      aspectos</a> do genesis que a descreve.</p>
      <p><code>net.java.dev.genesis.ui.metadata.FormMetadata</code> é o ponto
      inicial da árvore de metadados, contendo:</p>
      <ul>
        <li>a classe que representa, obtida através de
        <code>getFormClass()</code> e definida através do construtor
        <code>FormMetadata(Class)</code></li>
        <li>condições JXPath nomeadas, obtidas através de
        <code>getNamedConditions()</code> e
        <code>getNamedCondition(String conditionName)</code> e adicionadas
        através do método <code>addNamedCondition(String key,
        org.apache.commons.jxpath.CompiledExpression value)</code></li>
        <li>metadados das propriedades, obtidos através de
        <code>getFieldMetadatas()</code> e
        <code>getFieldMetadata(String fieldName)</code> e adicionadas
        através do método <code>addFieldMetadata(String fieldName,
        net.java.dev.genesis.ui.metadata.FieldMetadata fieldMetadata)</code>
        </li>
        <li>metadados dos métodos, obtidos através de
        <code>getMethodMetadatas()</code>,
        <code>getMethodMetadata(String methodName)</code> e
        <code>getMethodMetadata(net.java.dev.genesis.reflection.MethodEntry
        methodEntry)</code>
        e adicionados através do método <code>addMethodMetadata(String
        methodName,
        net.java.dev.genesis.ui.metadata.MethodMetadata methodMetadata)</code>
        </li>
        <li>métodos utilitários para obter metadados das ações e provedores de
        dados, <code>getActionMetadatas()</code> e
        <code>getMethodMetadatas()</code>, que utilizam informações contidas
        nos metadados dos métodos para gerar os valores de retorno</li>
      </ul>
      <p>Tanto <code>FieldMetadata</code> quanto <code>ActionMetadata</code>
      estendem a classe abstrata <code>MemberMetadata</code>, que contém as
      seguintes propriedades:</p>
      <ul>
        <li>nome, retornado pelo método abstrato <code>getName()</code></li>
        <li>condição de habilitação, obtido através de
        <code>getEnabledCondition()</code> e definido por
        <code>setEnabledCondition(org.apache.commons.jxpath.CompiledExpression
        enabledCondition)</code></li>
        <li>condição de visibilidade, obtido através de
        <code>getVisibleCondition()</code> e definido por
        <code>setVisibleCondition(org.apache.commons.jxpath.CompiledExpression
        visibleCondition)</code></li>
      </ul>
      <p>Além dos métodos herdados de <code>MemberMetadata</code>,
      <code>FieldMetadata</code> também contém as seguintes propriedades:</p>
      <ul>
        <li>condição de limpeza do valor do campo (
        <code>getClearOnCondition()</code> e
        <code>setClearOnCondition(org.apache.commons.jxpath.CompiledExpression
        clearOnCondition)</code>)</li>
        <li>conversor do valor do campo (<code>getConverter()</code> e
        <code>setConverter(org.apache.commons.beanutils.Converter
        converter)</code></li>
        <li>a implementação de
        <code>net.java.dev.genesis.resolvers.EmptyResolver</code> a ser usada
        para este campo (<code>getEmptyResolver()</code> e
        <code>setEmptyResolver(EmptyResolver emptyResolver)</code>)</li>
        <li>o valor considerado vazio para este campo (
        <code>getEmptyValue()</code> e <code>setEmptyValue(Object value)</code>)
        </li>
        <li>a implementação de
        <code>net.java.dev.genesis.equality.EqualityComparator</code> a ser
        usada para este campo (<code>getEqualityComparator()</code> e
        <code>setEqualityComparator(EqualityComparator equalityComparator)</code>)</li>
        <li>nome do campo, classe do campo e <code>boolean</code> indicando se
        este campo pode ser alterado, definidos no construtor e obtidos através
        dos métodos <code>getFieldName()</code>, <code>getFieldClass()</code> e
        <code>isWriteable()</code></li>
      </ul>
      <p><code>MethodMetadata</code> é utilizado para representar os métodos que
      sejam ações ou provedores de dados e contém as seguintes propriedades e
      métodos:</p>
      <ul>
        <li>a instância de
        <code>net.java.dev.genesis.reflection.MethodEntry</code> para o método
        que este metadado representa, inicializada a partir da instância de
        <code>java.lang.reflect.Method</code> passada no construtor e que pode
        ser obtida através do método <code>getMethodEntry()</code></li>
        <li>o nome do método, obtido através de <code>getName()</code></li>
        <li>um método <code>invoke(Object target)</code>, que invoca o método
        representado por esse metadado em <code>target</code></li>
        <li>a condição JXPath de chamada "automática" do método pelo framework,
        obtida através de <code>getCallCondition()</code> e definida pelo método
        <code>setCallCondition(org.apache.commons.jxpath.CompiledExpression
        callWhen)</code></li>
        <li>a instância de <code>ActionMetadata</code> e/ou de
        <code>DataProviderMetadata</code>, que são instanciadas dependendo dos
        valores booleanos passados ao construtor e que podem ser obtidas pelos
        métodos <code>getActionMetadata()</code> e
        <code>getDataProviderMetadata()</code></li>
      </ul>
      <p><code>ActionMetadata</code> possui, além das propriedades herdadas de
      <code>MemberMetadata</code>, apenas uma propriedade adicional:
      <code>validateBefore</code>, uma propriedade booleana que é manipulada
      através de um par de métodos get/set.</p>
      <p><code>DataProviderMetadata</code> contém diversas propriedades e
      métodos, sendo:</p>
      <ul>
        <li>nome do método provedor de dados, extraído a partir da instância de
        <code>Method</code> passada no construtor e obtida através de
        <code>getName()</code></li>
        <li>condição de "reset" dos dados, obtida através de <code>
        getClearOnCondition()</code> e definida através de
        <code>setClearOnCondition(org.apache.commons.jxpath.CompiledExpression
        clearOnCondition)</code></li>
        <li>nome do widget, obtido através de <code>getWidgetName()</code> e
        definido através de <code>setWidgetName(String widgetName)</code></li>
        <li>instância de <code>net.java.dev.genesis.reflection.FieldEntry</code>
        que representa o <code>objectField</code>, obtida através de
        <code>getObjectField()</code> e definida através do método
        <code>setObjectField(FieldEntry objectField)</code></li>
        <li>instância de <code>FieldEntry</code> que representa o
        <code>indexField</code>, obtida através de
        <code>getIndexField()</code> e definida através do método
        <code>setIndexField(FieldEntry indexField)</code></li>
        <li>propriedade booleana que indica se o provedor deverá ser invocado no
        momento do binding, obtido através de <code>isCallOnInit()</code> e
        definido através do método <code>setCallOnInit(boolean callOnInit)</code></li>
        <li>o método <code>getSelectedFields(Object indexes)</code> converte o
        parâmetro recebido - que pode ser uma array de inteiros, uma array de
        <code>Integer</code>, um <code>int</code> ou um <code>Integer</code>
        para uma array de <code>int</code>.</li>
        <li>o método <code>populateSelectedFields(java.lang.Object target,
        java.util.List objectList, int[] selectedIndexes)</code> seta o
        <code>objectField</code> e o <code>indexField</code> do objeto
        <code>target</code>, se existirem, para os valores selecionados de
        acordo com os índices selecionados (<code>selectedIndexes</code>) da
        lista de objetos retornados pelo provedor (<code>objectList</code>).</li>
        <li><code>resetSelectedFields(Object target)</code> "limpa" o conteúdo
        do <code>objectField</code> e/ou do <code>indexField</code> em <code>
        target</code>, se existirem</li>
      </ul>
      <p>Visto que é possível customizar a criação da instância de
      <code>FormMetadata</code> e que toda a hierarquia descrita aqui está
      referenciada por ela, é possível também customizar qualquer metadado para
      qualquer classe, criando-os com base em uma configuração xml ou estendendo
      uma das classes de metadados para implementar comportamento adicional.</p>
    </div><div class="section"><a name="Manipulando_o_estado_do_form"></a><h2>Manipulando o estado do form</h2>
      <p>O pacote <code>net.java.dev.genesis.ui.controller</code> possui
      diversas interfaces relacionadas ao estado do form e algumas
      implementações dessas interfaces. As interfaces são:</p>
      <ul>
        <li><b><code>FormState</code></b>: representa o estado do form</li>
        <li><b><code>FormController</code></b>: manipula o estado do form e
        dispara eventos relacionados a mudanças de estado</li>
        <li><b><code>FormControllerListener</code></b>: recebe os eventos de
        mudança do form</li>
        <li><b><code>FormControllerFactory</code></b>: cria uma instância de
        <code>FormController</code></li>
      </ul>
      <p>As interfaces descritas acima, bem como algumas de suas implementações,
      serão descritas nas subseções abaixo.</p>
      <div class="subsection"><a name="O_estado_do_form"></a><h3>O estado do form</h3>
        <p>A interface <code>FormState</code> expõe todo o estado de um form
        como instâncias de <code>java.util.Map</code>. Todas as chaves dos <code>Map</code>s são nomes das propriedades ou métodos do form como
        <code>String</code>. As propriedades expostas através de getters nesta
        interface são:</p>
        <ul>
           <li><b>valuesMap</b>: contém os valores do form num dado instante</li>
           <li><b>changedMap</b>: contém os valores que mudaram deste a última
           iteração do controlador</li>
           <li><b>enabledMap</b>: mantém valores <code>Boolean</code> indicando
           se os widgets que representam as propriedades ou métodos estão
           habilitados ou não. Seus valores nunca são <code>null</code></li>
           <li><b>visibleMap</b>: mantém valores <code>Boolean</code> indicando
           se os widgets que representam as propriedades ou métodos estão
           visíveis ou não. Seus valores nunca são <code>null</code></li>
           <li><b>dataProvidedMap</b>: contém os últimos valores retornados
           pelos provedores de dados como instâncias de
           <code>java.util.List</code></li>
        </ul>
        <p><code>FormStateImpl</code> implementa esta interface de forma simples
        e deve ser suficiente para a maioria dos casos. Esta classe possui um
        construtor adicional, além do default, que permite criar uma instância
        que é uma cópia de outro <code>FormState</code>.</p>
      </div>
      <div class="subsection"><a name="Controlando_o_estado_do_form"></a><h3>Controlando o estado do form</h3>
        <p><code>FormController</code> controla todas as mudanças de estado do
        form, manipulando a instância de <code>FormState</code> e disparando
        eventos de notificação de mudanças do estado para instâncias de
        <code>FormControllerListener</code>. Contém os seguintes métodos e
        constantes:</p>
        <ul>
          <li><code>CURRENT_STATE_KEY</code> define o nome da variável
          JXPath que contém a instância atual de <code>FormState</code></li>
          <li><code>FORM_METADATA_KEY</code> define o nome da variável
          JXPath que contém a instância de <code>FormMetadata</code></li>
          <li><code>getForm()</code>/<code>setForm(Object form)</code> e
          <code>getFormMetadata()</code>/<code>setFormMetadata(FormMetadata
          formMetadata)</code> permitem obter e definir as instâncias de form e
          de <code>FormMetadata</code> a serem usadas pelo controlador. Devem
          estar definidas antes da chamada a <code>setup()</code></li>
          <li><code>addFormControllerListener(FormControllerListener
          listener)</code>,
          <code>removeFormControllerListener(FormControllerListener
          listener)</code> e <code>getFormControllerListeners()</code> permitem
          adicionar, remover e obter instâncias de
          <code>FormControllerListener</code> que receberão os eventos
          propagados pelo controlador.</li>
          <li>o método <code>setup()</code> prepara a instância do controlador
          para uso e dispara todos os eventos relativos ao estado corrente do
          form para os listeners. Deve ser chamado somente uma vez. Para
          verificar se já foi chamado, deve-se utilizar o método
          <code>isSetup()</code></li>
          <li><code>fireAllEvents(FormControllerListener listener)</code>
          dispara todos os eventos declarados em
          <code>FormControllerListener</code> para a instância informada. É útil
          quando um listener não estava registrado antes da chamada a
          <code>setup()</code> e precisa ser notificado de todos os eventos.</li>
          <li><code>populate(Map properties, Map converters)</code> atualiza o
          form com os valores contidos em <code>properties</code> e reavalia
          todas as condições dos métodos e propriedades do form. O segundo
          <code>Map</code> passado para este método contém pares nome de
          propriedade / conversor do BeanUtils que podem ser usados para
          sobrescrever o conversor "natural" contido na instância de
          <code>FieldMetadata</code> que representa a propriedade</li>
          <li><code>invokeAction(String actionName, Map stringProperties)</code>
          chama a ação de nome <code>actionName</code> e reavalia todas as
          condições dos métodos e propriedades do form.
          <code>stringProperties</code> somente será usado se o método chamado
          for um ação que exija validação.</li>
          <li><code>updateSelection(DataProviderMetadata dataProviderMetadata,
          int[] selected)</code> muda a seleção em um determinado provedor de
          dados, atualizando o <code>objectField</code> e/ou
          <code>indexField</code>, se houverem, e reavalia todas as
          condições dos métodos e propriedades do form.</li>
          <li><code>update()</code> reavalia todas as condições dos métodos e
          propriedades do form e dispara todos os eventos referentes a mudanças
          do estado do form que ocorreram fora do controlador.</li>
          <li><code>getFormState()</code> retorna a instância de
          <code>FormState</code> que representa o estado atual do form. O
          retorno deste método pode ser usado em testes unitários ou para
          implementar funcionalidades como "cancelar alterações". Para se
          restaurar o form a um estado anterior, deve-se chamar o método
          <code>reset(FormState state)</code>, que atualizará o form e propagará
          todos os eventos necessários aos listeners.</li>
        </ul>
        <p><code>DefaultFormController</code> é a implementação desta interface
        provida pelo genesis, que pode ser usada também como base de uma
        implementação customizada de <code>FormController</code>. Possui alguns
        métodos <code>protected</code> adicionais e uma semântica mais bem
        definida para alguns dos métodos acima:</p>
        <ul>
          <li><code>createJXPathContext()</code>, <code>getFunctions()</code> e
          <code>getVariables()</code> inicializam o contexto JXPath utilizado na
          avaliação de todas as expressões usadas no genesis.
          <code>createJXPathContext()</code> cria um simples contexto usando a
          instância do form e registra </li>
        </ul>
      </div>
    </div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2004-2005, Summa Tecnologies do Brasil Ltda.</div><div class="clear"><hr></hr></div></div></body></html>