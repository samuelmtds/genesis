<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Formatando os dados - genesis</title><style type="text/css" media="all">
          @import url("../style/maven-base.css");
          
          @import url("../style/maven-theme.css");</style><link rel="stylesheet" href="../style/print.css" type="text/css" media="print"></link><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"></meta><meta name="author" content="Michael Nascimento Santos"></meta><meta name="email" content="mister__m@dev.java.net"></meta></head><body class="composite"><div id="banner"><a href="https://genesis.dev.java.net/" id="projectLogo"><img alt="SOL Genesis" src="../genesis.gif"></img></a><div class="clear"><hr></hr></div></div><div id="breadcrumbs"><div class="xleft">Last published: 27 May 2008
                <span class="separator">|</span> Doc for  3.1
                </div><div class="xright">
        
        <a href="../index.html">genesis</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-aspect/index.html">genesis-aspect</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-client/index.html">genesis-client</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-server/index.html">genesis-server</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../multiproject/genesis-shared/index.html">genesis-shared</a>
      
        
          
            <span class="separator">|</span>
          
        
        <a href="../tags/genesis-tags.html">genesis-xdoclet</a>
      </div><div class="clear"><hr></hr></div></div><div id="leftColumn"><div id="navcolumn"><div id="menugenesis"><h5>genesis</h5><ul><li class="none"><a href="../pt-BR/index.html">Visão geral</a></li><li class="none"><a href="../pt-BR/download.html">Downloads</a></li><li class="none"><a href="../pt-BR/release_notes.html">Notas de versão</a></li></ul></div><div id="menuDocumentação"><h5>Documentação</h5><ul><li class="expanded"><a href="../pt-BR/documentation_intro.html">Manual do usuário</a><ul><li class="none"><a href="../pt-BR/documentation_intro.html">Introdução</a></li><li class="none"><a href="../pt-BR/annotations.html">Usando anotações</a></li><li class="none"><a href="../pt-BR/startup.html">Inicializando o genesis</a></li><li class="expanded"><a href="../pt-BR/remoting.html">Funcionalidades básicas</a><ul><li class="none"><a href="../pt-BR/remoting.html">Remotabilidade transparente</a></li><li class="none"><a href="../pt-BR/transactions.html">Suporte a transações</a></li><li class="none"><a href="../pt-BR/hibernate_integration.html">Integração com o Hibernate</a></li><li class="none"><a href="../pt-BR/binding.html">Binding</a></li><li class="none"><a href="../pt-BR/actions.html">Implementando ações mistas</a></li></ul></li><li class="expanded"><a href="../pt-BR/thinlet_binding.html">Funcionalidades específicas para Thinlet</a><ul><li class="none"><a href="../pt-BR/thinlet_binding.html">Binding Thinlet</a></li><li class="none"><a href="../pt-BR/customizing_widgets_creation.html">Customizando a criação de componentes</a></li></ul></li><li class="expanded"><a href="../pt-BR/configuring_swt.html">Funcionalidades específicas para SWT</a><ul><li class="none"><a href="../pt-BR/configuring_swt.html">Configurando as bibliotecas do SWT</a></li></ul></li><li class="expanded"><a href="../pt-BR/conditions.html">Funcionalidades adicionais</a><ul><li class="none"><a href="../pt-BR/conditions.html">Trabalhando com condições</a></li><li class="none"><a href="../pt-BR/populating_with_dataproviders.html">Populando combos, listas e tabelas</a></li><li class="none"><a href="../pt-BR/binding_toggle_buttons.html">Binding de botões de rádio e caixas de seleção</a></li><li class="none"><a href="../pt-BR/binding_strategy.html">Mudando a estratégia de binding</a></li><li class="none"><strong><a href="../pt-BR/formatting.html">Formatando os dados</a></strong></li><li class="none"><a href="../pt-BR/handling_errors.html">Tratando erros</a></li><li class="none"><a href="../pt-BR/validating_data.html">Validando os dados</a></li><li class="none"><a href="../pt-BR/configuring_messages.html">Configurando as mensagens</a></li><li class="none"><a href="../pt-BR/paging_and_dynamic_search.html">Paginação e pesquisas dinâmicas</a></li></ul></li><li class="none"><a href="../pt-BR/quick_reference.html">Guia de referência rápida de anotações</a></li></ul></li><li class="expanded"><a href="../pt-BR/empty_project.html">Desenvolvendo com o genesis</a><ul><li class="none"><a href="../pt-BR/empty_project.html">Para desktops</a></li><li class="none"><a href="../pt-BR/empty_web_project.html">Para web</a></li></ul></li><li class="none"><a href="../pt-BR/useradmin_sample.html">Usando o exemplo UserAdmin</a></li><li class="expanded"><a href="../pt-BR/advanced_introduction.html">Guia avançado</a><ul><li class="none"><a href="../pt-BR/xdoclet_extensions.html">Extensões do XDoclet</a></li><li class="none"><a href="../pt-BR/aspects.html">Aspectos do genesis</a></li><li class="none"><a href="../pt-BR/generic_scripting.html">Suporte a linguagens de script</a></li><li class="none"><a href="../pt-BR/lookup_strategy.html">Estratégias de pesquisa de componentes gráficos</a></li><li class="none"><a href="../pt-BR/widget_binder.html">Customizando o binding de componentes gráficos</a></li></ul></li><li class="none"><a href="../pt-BR/faq.html">FAQ</a></li><li class="none"><a href="http://wiki.java.net/bin/view/Projects/GenesisRoadmap" class="externalLink" title="External Link">Roadmap</a></li><li class="none"><a href="http://wiki.java.net/bin/view/Projects/Genesis" class="externalLink" title="External Link">Wiki</a></li></ul></div><div id="menuProject_Documentation"><h5>Project Documentation</h5><ul><li class="none"><a href="../index.html">About</a></li><li class="collapsed"><a href="../project-info.html">Project Info</a></li><li class="collapsed"><a href="../maven-reports.html">Project Reports</a></li><li class="none"><a href="http://maven.apache.org/development-process.html" class="externalLink" title="External Link">Development Process</a></li></ul></div><div id="menujava_net"><h5>java.net</h5><ul><li class="none"><a href="https://genesis.dev.java.net" class="externalLink" title="External Link">genesis.dev.java.net</a></li><li class="none"><a href="http://java.net" class="externalLink" title="External Link"><img title="java.net member" style="border: 1px" src="../java_dot_net_member.bmp" alt="java.net member"></img></a></li></ul></div><div id="legend"><h5>Legend</h5><ul><li class="externalLink">External Link</li><li class="newWindow">Opens in a new window</li></ul></div><a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy"><img alt="Built by Maven" src="../images/logos/maven-button-1.png"></img></a></div></div><div id="bodyColumn"><div class="contentBox"><div class="section"><a name="Formatando_os_dados"></a><h2>Formatando os dados</h2>
      <p>Visto que formatar as informações para que sejam exibidas na tela é uma
      parte importante de qualquer aplicação com interface gráfica, espera-se
      que isto seja fácil de fazer e configurável. A API que é utilizada para
      este propósito no genesis encontra-se implementada no pacote
      <code>net.java.dev.genesis.text</code>.</p>
      <p>Encontra-se neste pacote a interface <code>Formatter</code>, que define
      o método <code>format(Object)</code>. Este método converte o objeto
      passado em uma String formatada. Da mesma forma como outros componentes do 
      framework, existe um registro padrão de implementações da interface, a 
      classe <code>FormatterRegistry</code>. As seguintes implementações estão 
      registradas por padrão nessa classe:</p>
      <ul>
        <li><code>EnumFormatter</code> converte instâncias de 
        <code>java.lang.Enum</code> e 
        <code>net.java.dev.reusablecomponents.lang.Enum</code> (para uso com 
        Java 1.4) procurando no
        <a href="configuring_messages.html#Configurando as mensagens"><code>ResourceBundle</code></a> a
        mensagem configurada para a chave formada pelo nome da classe sem pacote
        + "." + nome da constante. Se esta não for encontrada, uma mensagem de
        prioridade <code>INFO</code> será logada e a instância convertida com
        <code>toString()</code>.</li>
        <li><code>DefaultFormatter</code> é registrado para todos os outros
        tipos e converte as instâncias utilizando <code>toString()</code> -
        exceto se forem <code>null</code>, quando retorna uma String com tamanho
        zero.</li>
      </ul>
      <p>Para registrar um novo formatador para uma classe basta utilizar o
      método <code>register(Class,Formatter)</code> em
      <code>FormatterRegistry</code>.</p>
      <p>No entanto, o registro de um formatador por classe pode não ser
      suficiente em algumas situações. Por exemplo, ao se exibir uma propriedade
      booleana como texto, pode-se querer exibir determinado texto no lugar
      das constantes <code>true</code> e <code>false</code>. O genesis possui
      uma API que permite definir explicitamente o formatador de determinado
      campo utilizado na tela. Alguns passos são necessários para isso:</p>
      <ol>
        <li>Se o binding Thinlet estiver sendo utilizado, ao invés de utilizar 
        alguma versão do método <code>bind(..)</code>, deve-se preparar uma 
        instância de <code>ThinletBinder</code> para ser ligada a view e a um 
        widget utilizando-se os métodos <code>prepareBinder(form)</code> ou
        <code>prepareBinder(widget, form)</code> de
        <code>net.java.dev.genesis.ui.thinlet.BaseThinlet</code>.</li>
        <li>O formatador deve ser registrado utilizando-se o método
        <code>registerFormatter(String,Formatter)</code> em
        <code>net.java.dev.genesis.ui.thinlet.ThinletBinder</code> ou
        <code>net.java.dev.genesis.ui.binding.AbstractBinder</code>
        (para <code>Swing</code> e <code>SWT</code>) de acordo com a
        API gráfica utilizada. O valor da <code>String</code> deverá ser o nome 
        da propriedade cujo formatador será sobrescrito. Este nome de 
        propriedade é determinado da seguinte forma:
          <ul>
            <li>Caso a propriedade seja uma propriedade simples, retornada
            através de um método getter, deve ser usado apenas o nome simples
            dessa propriedade.</li>
            <li>Caso queira se mudar o formatador dos ítens de uma combobox ou
            lista ou de uma das colunas de uma tabela, o nome da propriedade
            deverá ser composto por
            <code>nomeDoWidget.nomePropriedadeObjetoExibido</code>.</li>
          </ul>
        </li>
        <li>Opcionalmente, caso a propriedade cujo formatador foi alterado
        precise ser convertida pelo genesis para seu tipo original e o formato
        gerado não for suportado pelo conversor, deve-se sobrescrever o
        conversor através do método
        <code>registerConverter(String,Converter)</code>.
        <code>org.apache.commons.beanutils.Converter</code> faz parte do
        Jakarta Commons BeanUtils e deve-se consultar a documentação deste
        framework caso seja necessário implementar esta interface.</li>
        <li>Finalmente, deve-se efetuar o binding chamando-se o método 
        <code>bind()</code>.</li>
      </ol>
      <p>Um exemplo destes passos pode ser visto abaixo:</p>

    <div class="source"><pre>
Formatter f = new Formatter() {
   public String format(Object o) {
      return "Formato alterado";
   }
};
</pre></div>
  


    <div class="source"><pre>
//Exemplo Thinlet
ThinletBinder binder = prepareBinder(form);
binder.registerFormatter("propriedade", f);
binder.bind();
</pre></div>
  


    <div class="source"><pre>
//Exemplo Swing
SwingBinder binder = new SwingBinder(this, form);
binder.registerFormatter("propriedade", f);
binder.bind();
</pre></div>
  


    <div class="source"><pre>
//Exemplo SWT
SWTBinder binder = new SWTBinder(shell, form, this);
binder.registerFormatter("propriedade", f);
binder.bind();
</pre></div>
  
      <p>O valor de <code>propriedade</code> exibido na tela será sempre a
      constante <code>Formato alterado</code>, independentemente do seu
      valor no form.</p>
      <p>Pode-se também reutilizar instâncias de <code>java.text.Format</code>
      como base de seu formatador usando <code>FormatAdapter</code>. Para exibir 
      números no formato <code>1.234,00</code>, poderia se gerar o formatador da
      seguinte forma:</p>

    <div class="source"><pre>
Formatter formatter = new FormatAdapter(new DecimalFormat("#,##0.00", true));
</pre></div>
  
      <p>O segundo parâmetro indica que valores <code>null</code> devem ser 
      formatados como uma <code>String</code> vazia.</p>
      <div class="subsection"><a name="Propriedades_virtuais"></a><h3>Propriedades virtuais</h3>
        <p>Desde a versão 2.2, é possível se trabalhar com propriedades
        virtuais, ou seja, que não existem no objeto sendo exibido. Essas
        propriedades tem seu valor de exibição determinado através em um
        formatador específico.</p> 
        <p>Caso a API gráfica utilizada seja Thinlet ou SWT, este formatador tem 
        de estar obrigatoriamente registrado na instância de 
        <code>ThinletBinder</code>/<code>SWTBinder</code>. Caso esteja-se 
        utilizando Swing, se o <code>TableCellRenderer</code> da 
        <code>TableColumn</code> não tiver sido customizado, o formatador deverá 
        ser registrado na instância de <code>SwingBinder</code>.</p>
        <p>O processo de definição e exibição de uma propriedade virtual é
        basicamente o mesmo de uma propriedade normal, exceto pelos pontos
        abaixos:</p>
        <ul>
           <li>Apenas células de tabelas e valores exibidos em comboboxes e
           listas podem ser propriedades virtuais.</li>
           <li>Propriedades virtuais podem ser definidas de maneira dependente 
           da API gráfica:
             <ul>
               <li>Caso esteja-se utilizando Thinlet, pode-se defini-las em 
               comboboxes e listas colocando no elemento <code>property</code> 
               do xml <code>virtual=true</code>. Visto que colunas de tabelas 
               não possuem o atributo <code>property</code>, o valor de seu 
               atributo <code>name</code> deve ser precedido do prefixo 
               <code>virtual:</code>.</li>
               <li>Caso esteja-se utilizando Swing ou SWT, o 
               <code>name</code>/<code>data</code> do widget deve ser precedido 
               pela constante definida em 
               <code>AbstractBinder.VIRTUAL_PREFIX</code> ou a 
               <code>clientProperty SwingBinder.VIRTUAL</code>/<code>data SWTBinder.VIRTUAL</code>
               deve possuir como valor <code>Boolean.TRUE</code></li>
             </ul>
           </li>
           <li>A instância de <code>Formatter</code> receberá como parâmetro do
           método <code>format(Object)</code> todo o bean sendo exibido, já que
           a propriedade a ser exibida não existe fisicamente no objeto.</li>
        </ul>
        <p>Um exemplo de definição e uso de uma propriedade virtual é mostrado
        abaixo, tanto para comboboxes como para tabelas. Primeiro vejamos a 
        definição da interface gráfica com Thinlet:</p>

    <div class="source"><pre>

&lt;panel gap="5"&gt;
   &lt;combobox name="widget"
             property="key=propriedadeUnica;value=valorVirtual;virtual=true" /&gt;
&lt;/panel&gt;

</pre></div>
  

    <div class="source"><pre>

&lt;panel gap="5"&gt;
   &lt;table name="widget"&gt;
      &lt;header&gt;
         &lt;column name="propriedadeUnica" text="#" /&gt;
         &lt;column name="virtual:valorVirtual" text="Virtual" /&gt;
      &lt;/header&gt;
   &lt;/table&gt;
&lt;/panel&gt;

</pre></div>
  
        <p>Abaixo temos a mesma interface definida com Swing:</p>

    <div class="source"><pre>
//..
getContentPane().setLayout(new GridLayout(1, 0, 5, 5));

JComboBox widget = new JComboBox();
widget.setName("widget");
widget.putClientProperty(SwingBinder.KEY_PROPERTY, "propriedadeUnica");
widget.putClientProperty(SwingBinder.VALUE_PROPERTY, "valorVirtual");
widget.putClientProperty(SwingBinder.VIRTUAL, Boolean.TRUE);
getContentPane().add(widget);
//..
</pre></div>
  

    <div class="source"><pre>
//..
getContentPane().setLayout(new GridLayout(1, 0, 5, 5));

JTable widget = SwingFactory.createTable(binder, "widget", 
      new String[] {"propriedadeUnica", AbstractBinder.VIRTUAL_PREFIX + "valorVirtual"},
      new String[] {"#", "Virtual"});

JScrollPane scrollPane = new JScrollPane();
scrollPane.setViewportView(widget);
getContentPane().add(scrollPane);

//..
</pre></div>
  
        <p>Abaixo temos a mesma interface definida com SWT:</p>

    <div class="source"><pre>
//..
Shell shell = new Shell();

Combo widget = new Combo(shell, SWT.NONE);
widget.setData("widget");
widget.setData(SWTBinder.KEY_PROPERTY, "propriedadeUnica");
widget.setData(SWTBinder.VALUE_PROPERTY, "valorVirtual");
widget.setData(SWTBinder.VIRTUAL, Boolean.TRUE);
//..
</pre></div>
  

    <div class="source"><pre>
//..
Shell shell = new Shell();

Table widget = new Table(usersComposite, SWT.MULTI | SWT.FULL_SELECTION | 
      SWT.VIRTUAL| SWT.BORDER);
widget.setData("widget");
widget.setHeaderVisible(true);

TableColumn column1 = new TableColumn(widget, SWT.NONE);
column1.setText("#");
column1.setData(SWTBinder.TABLE_COLUMN_IDENTIFIER, "propriedadeUnica");
column1.setWidth(50);

TableColumn column2 = new TableColumn(widget, SWT.NONE);
column2.setText("Virtual");
column2.setData(SWTBinder.TABLE_COLUMN_IDENTIFIER, AbstractBinder.VIRTUAL_PREFIX + 
      "valorVirtual");
column2.setWidth(200);
//..
</pre></div>
  
        <p>Abaixo temos a definição do formatador:</p>

    <div class="source"><pre>
Formatter virtual = new Formatter() {
   public String format(Object o) {
      return o == null ? "0" : String.valueOf(o.hashCode());
   }
}); 
</pre></div>
  
        <p>Por fim, o código que mostra como usar o formatador em ambas APIs:</p>

    <div class="source"><pre>
ThinletBinder binder = prepareBinder(form);
binder.registerFormatter("widget.valorVirtual", virtual);
binder.bind();
</pre></div>
  

    <div class="source"><pre>
SwingBinder binder = new SwingBinder(this, form);
binder.registerFormatter("widget.valorVirtual", virtual);
binder.bind();
</pre></div>
  

    <div class="source"><pre>
SWTBinder binder = new SWTBinder(shell, form, this);
binder.registerFormatter("widget.valorVirtual", virtual);
binder.bind();
</pre></div>
  
        <p>É importante notar que, embora o nome da coluna seja precedido de
        <code>virtual:</code>, isso não afeta a formação do nome da propriedade
        na hora de registrar o formatador.</p>
      </div>
      <div class="subsection"><a name="Utilizando_expressões_de_script_para_formatação"></a><h3>Utilizando expressões de script para formatação</h3>
        <p>A partir da versão 3.1, uma nova implementação de 
        <code>Formatter</code> permite formatar os dados utilizando uma 
        expressão de script - 
        <code>net.java.dev.genesis.text.ScriptFormatter</code>.</p>
        <p>Um exemplo de criação de uma nova instância dessa classe encontra-se 
        abaixo. Supondo que exista uma classe com as propriedades 
        <code>codigo</code> e <code>descricao</code> e que a linguagem de script
        seja JavaScript, o seguinte trecho de código:</p>

    <div class="source"><pre>
Formatter f = new ScriptFormatter(form, "o.codigo + ' - ' + o.descricao");
</pre></div>
  
        <p>permite formatar uma instância com valores <code>[codigo=1, 
        descricao="Valor"]</code> como <code>1 - Valor</code>.</p>
        <p>O nome de variável <code>o</code> é usado por padrão, mas é possível
        substituí-lo por outro se necessário utilizando o terceiro parâmetro da 
        outra versão do construtor.</p>
        <p>É importante ter em mente que <b>o construtor de 
        <code>ScriptFormatter</code> só pode ser chamado após a criação do 
        binder</b>, pois é necessário que certos objetos de uso interno do 
        genesis já tenham sido inicializados.</p>
      </div>
    </div></div></div><div class="clear"><hr></hr></div><div id="footer"><div class="xright">© 2004-2008, Summa Technologies do Brasil Ltda.</div><div class="clear"><hr></hr></div></div></body></html>